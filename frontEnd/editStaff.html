<!DOCTYPE html>
<html lang="en">
<head>
    <style type="text/css">
        @import "css/detailInfo.css";
    </style>
    <meta charset="UTF-8">
    <script src="js/jquery-3.2.1.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <title>修改员工信息</title>
</head>
<script>
    //将CSS中的长度信息转换为对应的数字
    function getLengthNum(elementName,attrType){
        var len = $(elementName).css(attrType);
        return parseInt(len.substr(0,len.length-2));
    }

    $(document).ready(function () {
        $("#circle_image").css("height",$("#circle_image").css("width"));

        $.post("url",{
            "name":"info"
        },function (data,state) {
            var info=JSON.parse(data);
            $("#image_show").attr("src",info["src"]);
            $("#dish_name_input").attr("value",info["name"]);
            $("#dish_type_input").attr("value",info["type"]);
            $("#dish_price_input").attr("value",info["price"]);
            $("#dish_sales_input").attr("value",info["sales"]);
        },"json");

        $("#confirm_btn").bind("click",function () {
            $.post("url",{
                "dish_category":$("#dish_type_input").attr("value"),
                "dish_name":$("#dish_name_input").attr("value"),
                "dish_intro":$("#dish_intro_input").attr("value"),
                "dish_price":$("#dish_price_input").attr("value"),
                "dish_sales":$("#dish_sales_input").attr("value")
            },function(data,status){

            },"json");
        });

        $("#cancel_btn").bind("click",function () {
            $(window).attr('location',"dishDataInfo.html");
        });

        $("#image_show").bind("click",function () {
            $("#imgUpload").click();
        })

        $("#imgUpload").change(function(e) {
            for (var i = 0; i < e.target.files.length; i++) {
                var file = e.target.files.item(i);
                var freader = new FileReader();
                freader.readAsDataURL(file);
                freader.onload = function(e) {
                    var src = e.target.result;
                    $("#image_show").attr("src",src);
                }
                $("#circle_image").css("background-color","#000000")
            }
        });

        $("#circle_image").css("left",(getLengthNum(".basic_lane","width")*0.5-140).toString()+"px");
        $("#dish_title").css("left",(getLengthNum(".basic_lane","width")*0.5-120).toString()+"px");
        $("#dish_name").css("left",(getLengthNum(".basic_lane","width")*0.5-120).toString()+"px");

        var staff_id=document.URL.split("?")[1].split("=")[1];
        $.ajax({
            type:"GET",
            url:"/user/"+staff_id,
            dataType:"json",
            success:function (data,status) {
<<<<<<< HEAD
                if(status==="200"){
                    var type=["管理员","厨师","服务员"];
                    var parsedData=JSON.parse(data);
=======
                if(status==="success"){
                    var type=["管理员","厨师","服务员"];
                    var parsedData=data;
>>>>>>> c0e5c0ee7acac5af42d6fadcf1e1b778c689cfc5
                    $("#staff_name_input").val(parsedData["name"]);
                    $("#circle_image").attr("src",parsedData["photo"]);
                    $("#staff_type_input").val(type[parseInt(parsedData["type"])]);
                    $("#staff_account_input").val(parsedData["account"]);
                }
                else{
                    alert("系统错误");
                    window.location="staffInfo.html";
                }
            },
            error:function () {
                alert("系统错误");
                window.location="staffInfo.html";
            }
        });
        $("#confirm_btn").bind("click",function () {
            var career=$("#staff_type_input").val();
            if(!(career==="管理员" || career==="厨师" || career==="服务员"))
                alert("员工类型不存在！");
            else{
                var name=$("#staff_name_input").val();
                var account=$("#staff_account_input").val();
                var password=$("#staff_password_input").val();
                var repassword=$("#repassword_input").val();
                if(!(password===repassword))
                    alert("输入密码和重输密码不一致！");
                else{
                    if(name==="" || account==="" || password==="")
                        alert("所填信息不能有空！");
                    else{
<<<<<<< HEAD

=======
                        $.ajax({
                            type:"POST",
                            url:"/user"+staff_id,
                            data:{
                                "name":$("#staff_name_input").val(),
                                ""
                            },
                            dataType:"json",
                            success:function (data,status) {

                            },
                            error:function () {

                            }
                        });
>>>>>>> c0e5c0ee7acac5af42d6fadcf1e1b778c689cfc5
                    }
                }
            }
        });
    });

    $(window).resize(function () {
        var basic_length = getLengthNum(".basic_lane","width");
        var detailed_length = getLengthNum(".detailed_lane","width");
        if(basic_length<=300) {
            $(".basic_lane").css("width", "300px");
            $(".detailed_lane").css("left", "300px");
        }
        if(detailed_length<=557)
            $(".detailed_lane").css("width","557px");

        var window_length=$(window).width();
        if(window_length>=857){
            $(".basic_lane").css("width", "35%");
            $(".detailed_lane").css("width", "65%");
            $(".detailed_lane").css("left","35%")
        }

        $("#circle_image").css("left",(getLengthNum(".basic_lane","width")*0.5-140).toString()+"px");
        $("#staff_title").css("left",(getLengthNum(".basic_lane","width")*0.5-120).toString()+"px");
        $("#staff_name_input").css("left",(getLengthNum(".basic_lane","width")*0.5-120).toString()+"px");
    });
</script>
<body>
<div class="basic_lane">
    <div class="container">
        <div class="row rowdis">
            <form class="circle_image" id="circle_image">
                <input type="file" class="head_pic" id="imgUpload">
                <img id="image_show">
            </form>
        </div>
        <div class="row rowdis">
            <div class="title" id="staff_title">员工名称</div>
        </div>
        <div class="row rowdis">
            <input class="name_input" type="text" id="staff_name_input">
        </div>
    </div>
</div>
<div class="detailed_lane">
    <div class="container dish_table">
        <div class="row rowdis">
            <div class="col-md-3">
                <span class="normal_info_title">员工类别</span>
            </div>
            <div class="col-md-6">
                <input class="input_info" type="text" id="staff_type_input">
            </div>
        </div>
        <div class="row rowdis">
            <div class="col-md-3">
                <span class="normal_info_title">员工账号</span>
            </div>
            <div class="col-md-6">
                <input class="input_info" type="text" id="staff_account_input">
            </div>
        </div>
        <div class="row rowdis">
            <div class="col-md-3">
                <span class="normal_info_title">账号密码</span>
            </div>
            <div class="col-md-6">
                <input class="input_info" type="password" id="staff_password_input">
            </div>
        </div>
        <div class="row rowdis">
            <div class="col-md-3">
                <span class="normal_info_title">确认密码</span>
            </div>
            <div class="col-md-6">
                <input class="input_info" type="password" id="repassword_input">
            </div>
        </div>
        <div class="row rowdis">
            <div class="col-md-5"><h1></h1></div>
            <div class="col-md-2">
                <input type="submit" value="确定" class="click_btn" id="confirm_btn">
            </div>
            <div class="col-md-2">
                <input type="submit" value="取消" class="click_btn" id="cancel_btn">
            </div>
        </div>
    </div>
</div>
</body>
</html>