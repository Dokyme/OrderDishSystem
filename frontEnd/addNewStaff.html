<!DOCTYPE html>
<html lang="en">
<head>
    <style type="text/css">
        @import "css/detailInfo.css";
    </style>
    <meta charset="UTF-8">
    <script src="js/jquery-3.2.1.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <title>新增员工信息</title>
</head>
<script>
    //将CSS中的长度信息转换为对应的数字
    function getLengthNum(elementName,attrType){
        var len = $(elementName).css(attrType);
        return parseInt(len.substr(0,len.length-2));
    }

    $(document).ready(function () {
        $("#circle_image").css("height",$("#circle_image").css("width"));

        $("#image_show").bind("click",function () {
            $("#imgUpload").click();
        });

        $("#imgUpload").change(function(e) {
            for (var i = 0; i < e.target.files.length; i++) {
                var file = e.target.files.item(i);
                var freader = new FileReader();
                freader.readAsDataURL(file);
                freader.onload = function(e) {
                    var src = e.target.result;
                    $("#image_show").attr("src",src);
                }
                $("#circle_image").css("background-color","#000000")
            }
        });

        $("#circle_image").css("left",(getLengthNum(".basic_lane","width")*0.5-140).toString()+"px");
        $("#staff_title").css("left",(getLengthNum(".basic_lane","width")*0.5-120).toString()+"px");
        $("#staff_name").css("left",(getLengthNum(".basic_lane","width")*0.5-120).toString()+"px");

        $("#confirm_btn").bind("click",function () {
            var valid_career=["管理员","后厨","服务员"];
            var staff_name=$("#staff_name_input").val();
            var staff_category=$("#staff_type_input").val();
            var staff_account=$("#staff_account_input").val();
            var staff_password=$("#staff_password_input").val();
            var staff_repassword=$("#repassword_input").val();
            if(staff_name==="" || staff_category==="" || staff_account==="" || staff_password==="" || staff_repassword===""){
                alert("信息未输全！");
            }
            else{
                if(!(staff_category===valid_career[0] || staff_category===valid_career[1] || staff_category===valid_career[2]))
                    alert("员工类别输入有误！");
                else if(!(staff_password===staff_repassword))
                    alert("密码两次输入不同！");
                else{
                    var ajax_option={
                        url: url,                  //String, 表单提交的目标地址，此属性会覆盖表单的action属性
                        type:"POST",             //String，表单提交的方式(POST or GET)，此属性会覆盖表单的method属性
                        dataType: null,    //String，指定接受服务端返回的数据类型(xml，script  or  json)
                        clearForm: true,   //boolean，默认为false，成功提交后是否清除所有表单元素的值
                        resetForm: true,  //boolean，默认为false，成功提交后是否重置所有表单元素的值
                        timeout: 3000,    //number，单位ms，限制请求的时间，当请求大于设置的时间后，跳出请求
                        success:function(responseText,statusText,xhr,$form){
                            console.log(responseText);//业务提示
                        }
                    };

                    //表单提交事件
                    $("#circle_image").submit(function(){
                        $("#circle_image").ajaxSubmit(ajax_option);
                        return false;
                    });

                    $.ajax({
                        url:"/dish/",
                        type:"PUT",
                        data:{
                            "name":staff_name,
                            "account":staff_account,
                            "password":staff_password,
                            "type":staff_category
                        },
                        dataType:"json",
                        success:function (data,status) {
                            if(status==="success"){
                                alert("上传成功！");
                                window.location="staffInfo.html";
                            }
                            else{
                                alert("上传失败！");
                            }
                        },
                        error:function () {
                            alert("网络错误！");
                        }
                    });
                }
            }
        });

        $("#exit_btn").bind("click",function () {
            window.location="dishInfo.html";
        });
    });

    $(window).resize(function () {
        var basic_length = getLengthNum(".basic_lane","width");
        var detailed_length = getLengthNum(".detailed_lane","width");
        if(basic_length<=300) {
            $(".basic_lane").css("width", "300px");
            $(".detailed_lane").css("left", "300px");
        }
        if(detailed_length<=557)
            $(".detailed_lane").css("width","557px");

        var window_length=$(window).width();
        if(window_length>=857){
            $(".basic_lane").css("width", "35%");
            $(".detailed_lane").css("width", "65%");
            $(".detailed_lane").css("left","35%")
        }

        $("#circle_image").css("left",(getLengthNum(".basic_lane","width")*0.5-140).toString()+"px");
        $("#staff_title").css("left",(getLengthNum(".basic_lane","width")*0.5-120).toString()+"px");
        $("#staff_name_input").css("left",(getLengthNum(".basic_lane","width")*0.5-120).toString()+"px");
    });
</script>
<body>
<div class="basic_lane">
    <div class="container">
        <div class="row rowdis">
            <form class="circle_image" id="circle_image">
                <input type="file" class="head_pic" id="imgUpload">
                <img id="image_show">
            </form>
        </div>
        <div class="row rowdis">
            <div class="title" id="staff_title">员工姓名</div>
        </div>
        <div class="row rowdis">
            <input type="text" class="name_input" id="staff_name_input" placeholder="例：张三">
        </div>
    </div>
</div>
<div class="detailed_lane">
    <div class="container dish_table">
        <div class="row rowdis">
            <div class="col-md-3">
                <span class="normal_info_title">员工类别</span>
            </div>
            <div class="col-md-6">
                <input class="input_info" type="text" id="staff_type_input" placeholder="例：服务员">
            </div>
        </div>
        <div class="row rowdis">
            <div class="col-md-3">
                <span class="normal_info_title">员工账号</span>
            </div>
            <div class="col-md-6">
                <input class="input_info" type="text" id="staff_account_input" placeholder="例：User3">
            </div>
        </div>
        <div class="row rowdis">
            <div class="col-md-3">
                <span class="normal_info_title">账号密码</span>
            </div>
            <div class="col-md-6">
                <input class="input_info" type="password" id="staff_password_input" placeholder="输入密码">
            </div>
        </div>
        <div class="row rowdis">
            <div class="col-md-3">
                <span class="normal_info_title">确认密码</span>
            </div>
            <div class="col-md-6">
                <input class="input_info" type="password" id="repassword_input" placeholder="请再输一次密码">
            </div>
        </div>
        <div class="row rowdis">
            <div class="col-md-5"><h1></h1></div>
            <div class="col-md-2">
                <input type="submit" value="确定" class="click_btn" id="confirm_btn">
            </div>
            <div class="col-md-2">
                <input type="submit" value="取消" class="click_btn" id="cancel_btn">
            </div>
        </div>
    </div>
</div>
</body>
</html>