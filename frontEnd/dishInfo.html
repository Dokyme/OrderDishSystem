<!DOCTYPE html>
<html lang="en">
<style type="text/css">
    @import "css/InfoManage.css";
    @import "css/background.css";
</style>
<head>
    <meta charset="UTF-8">
    <script src="js/jquery-3.2.1.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/background.js"></script>
    <script src="js/tableinfo.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <title>菜品数据管理</title>
</head>
<body>

<script>
    $(window).ready(function(){
        showTime();
    });

    $(window).resize(function () {
        if($(window).width()<800)
            $(".headline").css("width","800px");
        else
            $(".headline").css("width","100%");
        if($(window).height()<400)
            $(".sideline").css("height","340px");
        else
            $(".sideline").css("height","calc(100% - 60px)")
    });

    $(document).ready(function () {
        $.ajax({
            type:"GET",
            url:"http://223.3.123.116:8080/dish/",
            dataType:"json",
            success:function(data,status){
                alert("success function");
                if(status==="success"){
                    if($.isEmptyObject(data))
                        alert("现在没有菜品信息！");
                    else{
                        var parsedData=data;
                        var i;
                        for(i in parsedData){
                            var strHtml=dishManageTableOutput(i,parsedData[i]);
                            $("#dish_table_body").append(strHtml);
                            $("#edit_"+i.toString()).bind("click",function(){
                                window.location.href="editDish.html?id="+parsedData[i]["id"];
                            });
                            $("#cancel_"+i.toString()).bind("click",function () {
                                if(confirm("取消该菜品信息？")){
                                    $.ajax({
                                        type:"DEL",
                                        url:"/dish/"+parsedData[i]["id"],
                                        dataType:"json",
                                        success:function(data,status){
                                            if(status==="204"){
                                                alert("取消成功！");
                                                $("#row_" + i.toString()).remove();
                                            }
                                            else{
                                                alert("取消失败！");
                                            }
                                        },
                                        error:function(){
                                            alert("取消失败！");
                                        }
                                    });
                                }
                            });
                        }
                    }
                }
                else if(status==="403"){
                    alert("您没有相应权限！");
                }
            }
        });


        $("#add").bind("click",function () {
            window.location="addNewDish.html";
        });

    });
</script>
<body>
<div class="headline">
    <div style="position:absolute;margin-left: 10px;display: inline;left:0;">
        <img src="image/restaurant.png" class="headline_pic">
        <div id="headtext_1">餐厅点餐系统</div>
    </div>
    <div style="position:absolute;margin-left: 10px;display: inline; left:30%;">
        <img src="image/staff.png" class="headline_pic">
        <div id="headtext_2">欢迎你，管理员！</div>
    </div>
    <div style="position:absolute;margin-left: 10px;display: inline; right:2%;">
        <label id="headtext_3"></label>
        <img src="image/exit.png" class="headline_pic">
    </div>
</div>
<div class="sideline">
    <div>
        <input type="button" class="sideline_btn" style="top:5%;" id="pay_btn" value="账单支付">
    </div>
    <div>
        <input type="button" class="sideline_btn" style="top:20%" id="dish_btn" value="菜品信息管理">
    </div>
    <div>
        <input type="button" class="sideline_btn" style="top:35%" id="staff_btn" value="员工信息管理">
    </div>
    <div>
        <input type="button" class="sideline_btn" style="top:50%" id="data_btn" value="数据维护管理">
    </div>
    <div>
        <input type="button" class="sideline_btn" style="top:65%" id="manage_btn" value="经营数据查看">
    </div>
</div>
<div class="content">
    <div class="top_line">
        <div class="date_text">筛选字段</div>
        <input type="button" id="select_key" value="菜品种类">
        <div class="date_text">筛选条件</div>
        <input type="text" id="select_case" placeholder="例：>=50">
        <input type="button" class="query_btn" id="query" value="查询">
        <input type="button" class="add_btn" id="add" value="新增菜品信息">
    </div>
    <div class="info_table mytable">
        <div class="table-responsive">
            <table class="table" id="dish_table">
                <thead>
                <tr>
                    <th>菜品种类<img src="image/down.png" class="head_icon" id="category_icon"></th>
                    <th>菜品名称</th>
                    <th>菜品价格<img src="image/down.png" class="head_icon" id="price_icon"></th>
                    <th>菜品销量<img src="image/down.png" class="head_icon" id="sales_icon"></th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody id="dish_table_body">
                <tr>
                    <td>中餐</td>
                    <td>酸菜鱼</td>
                    <td>¥48</td>
                    <td>56</td>
                    <td>
                        <div>
                            <img src="image/edit.png" class="content_icon">
                            <img src="image/cancel.png" class="content_icon">
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>