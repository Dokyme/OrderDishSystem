<!DOCTYPE html>
<html lang="en">
<style type="text/css">
    @import "css/InfoManage.css";
    @import "css/background.css";
</style>
<head>
    <meta charset="UTF-8">
    <script src="js/jquery-3.2.1.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/tableinfo.js"></script>
    <script src="js/background.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <title>经营数据查看</title>
</head>
<body>

<script>
    $(window).ready(function(){
        showTime();
    });

    $(window).resize(function () {
        if($(window).width()<800)
            $(".headline").css("width","800px");
        else
            $(".headline").css("width","100%");
        if($(window).height()<400)
            $(".sideline").css("height","340px");
        else
            $(".sideline").css("height","calc(100% - 60px)")
    });

    $(document).ready(function () {
        var step=2;
        $("#triple_1").bind("click",function () {
            $("#triple_1").css("background-color","lightblue");
            $("#triple_2").css("background-color","lightyellow");
            $("#triple_3").css("background-color","lightyellow");
            step=0;
        });
        $("#triple_2").bind("click",function () {
            $("#triple_1").css("background-color","lightyellow");
            $("#triple_2").css("background-color","lightblue");
            $("#triple_3").css("background-color","lightyellow");
            step=1;
        });
        $("#triple_3").bind("click",function () {
            $("#triple_1").css("background-color","lightyellow");
            $("#triple_2").css("background-color","lightyellow");
            $("#triple_3").css("background-color","lightblue");
            step=2;
        });

        var judge_url=document.URL.split("?")[1];
        if(!(judge_url==="")){
            var startTime=judge_url.split("&")[0].split("=")[1];
            var endTime=judge_url.split("&")[1].split("=")[1];
            var step=judge_url.split("&")[2].split("=")[1];
            getManageInfo(startTime,endTime,step);
        }

        $("#query").bind("click",function () {
            var startTime=$("#begin_date").val();
            var endTime=$("#end_date").val();
            getManageInfo(startTime,endTime,step);
        });
    });

    function getManageInfo(startTime,endTime,step){
        $.ajax({
            type: "GET",
            url: "http://223.3.123.116:8080/statistics?startTime="+startTime+"&endTime="+endTime+"&step="+step.toString(),
            dataType: "json",
            success: function (data, status) {
                if (status === "success") {
                    if ($.isEmptyObject(data))
                        alert("现在没有经营信息！");
                    else {
                        var parsedData = data;
                        var i;
                        for (i in parsedData) {
                            var strHtml = moneyManageTableOutput(i, parsedData[i]);
                            $("#money_table_body").append(strHtml);
                            $("#row_"+i.toString()).bind("click",function () {
                                window.location="billInfo.html?currentTime="+parsedData["time"]+"&startTime="+startTime+"&endTime="+endTime+"&step="+step;
                            });
                        }
                    }
                }
                else if (status === "403") {
                    alert("您没有相应权限！");
                }
            }
        });
    }
</script>

<body>
<div class="headline">
    <div style="position:absolute;margin-left: 10px;display: inline;left:0;">
        <img src="image/restaurant.png" class="headline_pic">
        <div id="headtext_1">餐厅点餐系统</div>
    </div>
    <div style="position:absolute;margin-left: 10px;display: inline; left:30%;">
        <img src="image/staff.png" class="headline_pic">
        <div id="headtext_2">欢迎你，管理员！</div>
    </div>
    <div style="position:absolute;margin-left: 10px;display: inline; right:2%;">
        <label id="headtext_3"></label>
        <img src="image/exit.png" class="headline_pic">
    </div>
</div>
<div class="sideline">
    <div>
        <input type="button" class="sideline_btn" style="top:5%;" id="pay_btn" value="账单支付">
    </div>
    <div>
        <input type="button" class="sideline_btn" style="top:20%" id="dish_btn" value="菜品信息管理">
    </div>
    <div>
        <input type="button" class="sideline_btn" style="top:35%" id="staff_btn" value="员工信息管理">
    </div>
    <div>
        <input type="button" class="sideline_btn" style="top:50%" id="data_btn" value="数据维护管理">
    </div>
    <div>
        <input type="button" class="sideline_btn" style="top:65%" id="manage_btn" value="经营数据查看">
    </div>
</div>
<div class="content">
    <div class="date_line">
        <div class="date_text">开始日期</div>
        <input type="date" class="date_item" id="begin_date" value="2017-09-01">
        <div class="date_text">结束日期</div>
        <input type="date" class="date_item" id="end_date" value="2017-09-02">
        <input type="button" class="query_btn" id="query" value="查询">
    </div>
    <div class="select_situation">
        <input type="button" class="triple_select" id="triple_1" value="按年份">
        <input type="button" class="triple_select" id="triple_2" value="按月份">
        <input type="button" class="triple_select" id="triple_3" value="按天">
    </div>
    <div class="info_table mytable_2">
        <div class="table-responsive">
            <table class="table" id="money_table">
                <thead>
                <tr>
                    <th>时间</th>
                    <th>收入</th>
                    <th>菜品销量</th>
                    <th>翻台率</th>
                </tr>
                </thead>
                <tbody id="money_table_body">
                <tr>
                    <td>2017-08-29</td>
                    <td>¥1230</td>
                    <td>132</td>
                    <td>1.34</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>