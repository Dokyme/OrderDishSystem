<!DOCTYPE html>
<html lang="en">
<style type="text/css">
    @import "css/InfoManage.css";
    @import "css/background.css";
</style>
<head>
    <meta charset="UTF-8">
    <script src="js/jquery-3.2.1.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/tableinfo.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <title>菜品数据管理</title>
</head>

<style type="text/css">
    .bill_table{
        position: relative;
        left:10%;
        top:10%;
        width:80%;
        max-height: 80%;
        overflow: scroll;
    }
</style>

<body>

<script>
    $(window).ready(function(){
        showTime();
    });

    $(window).resize(function () {
        if($(window).width()<800)
            $(".headline").css("width","800px");
        else
            $(".headline").css("width","100%");
        if($(window).height()<400)
            $(".sideline").css("height","340px");
        else
            $(".sideline").css("height","calc(100% - 60px)")
    });

    $(document).ready(function{
        $.ajax({
            type:"GET",
            url:"/order/",
            dataType:"json",
            success:function(data,status){
                if(status==="200"){
                    if($.isEmptyObject(data))
                        alert("现在没有订单！");
                    else{
                        var parsedData=JSON.parse(data);
                        var i;
                        for(i in parsedData){
                            var strHtml=payBillTableOutput(i,parsedData[i]);
                            $("#order_table_body").append(strHtml);
                            $("#confirm_"+i.toString()).bind("click",function(){
                                if(confirm("确认结账？")) {
                                    $.ajax({
                                        type:"POST",
                                        url:"/order/"+parsedData[i]["orderId"],
                                        dataType:"json",
                                        success:function(data,status){
                                            if(status==="204"){
                                                alert("结账成功！");
                                                $("#row_" + i.toString()).remove();
                                            }
                                            else{
                                                alert("结账失败！");
                                            }
                                        },
                                        error:function(){
                                            alert("结账失败！");
                                        }
                                    });
                                }
                            });
                            $("#cancel_"+i.toString()).bind("click",function () {
                                if(confirm("取消该账单？")){
                                    $.ajax({
                                        type:"DEL",
                                        url:"/order/"+parsedData[i]["orderId"],
                                        dataType:"json",
                                        success:function(data,status){
                                            if(status==="204"){
                                                alert("取消成功！");
                                                $("#row_" + i.toString()).remove();
                                            }
                                            else{
                                                alert("取消失败！");
                                            }
                                        }
                                        error:function(){
                                            alert("取消失败！");
                                        }
                                    });
                                }
                            });
                        }
                    }
                }
                else if(status==="403"){
                    alert("您没有相应权限！");
                }
            }
        });
    });

</script>
<body>
<div class="headline">
    <div style="position:absolute;margin-left: 10px;display: inline;left:0;">
        <img src="image/restaurant.png" class="headline_pic">
        <div id="headtext_1">餐厅点餐系统</div>
    </div>
    <div style="position:absolute;margin-left: 10px;display: inline; left:30%;">
        <img src="image/staff.png" class="headline_pic">
        <div id="headtext_2">欢迎你，管理员！</div>
    </div>
    <div style="position:absolute;margin-left: 10px;display: inline; right:2%;">
        <label id="headtext_3"></label>
        <img src="image/exit.png" class="headline_pic">
    </div>
</div>
<div class="sideline">
    <div>
        <input type="button" class="sideline_btn" style="top:5%;" id="pay_btn" value="账单支付">
    </div>
    <div>
        <input type="button" class="sideline_btn" style="top:20%" id="pay_btn" value="菜品信息管理">
    </div>
    <div>
        <input type="button" class="sideline_btn" style="top:35%" id="pay_btn" value="员工信息管理">
    </div>
    <div>
        <input type="button" class="sideline_btn" style="top:50%" id="pay_btn" value="数据维护管理">
    </div>
    <div>
        <input type="button" class="sideline_btn" style="top:65%" id="pay_btn" value="经营数据查看">
    </div>
</div>

<div class="content" >
    <div class="info_table bill_table">
        <div class="table-responsive">
            <table class="table" id="staff_table">
                <thead>
                <tr>
                    <th></th>
                    <th>桌号</th>
                    <th>时间</th>
                    <th>总价</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody id="order_table_body">
                <tr>
                    <td><img src="image/detail.png" style="width:20px;height:20px;"</td>
                    <td>C02</td>
                    <td>2017-09-17  11:32:33</td>
                    <td>¥188</td>
                    <td>
                        <div>
                            <img src="image/confirm.png" class="content_icon" id="confirm_1">
                            <img src="image/cancel.png" class="content_icon" id="cancel_1">
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
</body>
</html>