<!DOCTYPE html>
<html lang="en">
<style type="text/css">
    @import "/WEB-INF/static/login.css";
</style>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/WEB-INF/static/css/bootstrap.min.css">
    <script src="/static/js/jquery-3.2.1.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <title>登陆页面</title>
    <script>
        var verifyNum;
        $(document).ready(function () {
            $.post("url", {
                "name": "verify"
            },
                function (data) {
                    var response = JSON.parse(data);
                    $("#verify_pic").attr("src", response["url"]);
                    verifyNum = response["number"];
                }, "json");

            $("#verify_pic").bind("click", function () {
                $.post("url", {
                    "name": "varify"
                },
                    function (data) {
                        var response = JSON.parse(data);
                        $("#verify_pic").attr("src", response["url"]);
                        verifyNum = response["number"];
                    }, "json")
            });

            $("#submit").bind("click", function () {
                // if ($("#login_text").attr("value") === verifyNum.toString()) {
                    $.post("localhost:8080/login", {
                        "username": $("username").attr("value"),
                        "password": $("password").attr("value"),
                        "captcha": $("verify").attr("value")
                    },
                        function (data, state) {
                            if (state == 200) {
                                var response = JSON.parse(data);
                                if (response["flag"] === "1") {
                                    var usertype = response["type"];
                                    if (usertype === "1") {

                                    }
                                    else if (usertype === "2") {

                                    }
                                    else {

                                    }
                                }
                            }
                            else{
                                $("error_message").attr("value", state);
                                clearAll();
                            }
                        }, "json")
                // }
                // else {
                //     $("#error_message").html("验证码输入错误，请重输！");
                //     $("#verify").attr("value", "");
                //     $("#verify_pic").click();
                // }
            });
        });

        function clearAll() {
            $("#username").attr("value", "");
            $("#password").attr("value", "");
            $("#verify").attr("value", "");
            $("#verify_pic").click();
        }
    </script>
</head>


<body>
    <div class="background_pic">
        <img src="image/login_background.jpg">
    </div>
    <headline id="headline">
        餐厅点餐系统
    </headline>
    <div id="login_box">
        <label id="error_message"></label>
        <p class="login_text">用户名</p>
        <input id="username" type="text" placeholder="  Username" autofocus required>
        <p class="login_text">密码</p>
        <input id="password" type="password" placeholder="  Password" required>
        <p class="login_text">验证码</p>
        <input id="verify" type="text">
        <img id="verify_pic">
        <input id="submit" type="submit" value="登  陆">
    </div>
</body>

</html>